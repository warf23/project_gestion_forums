  <!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Career Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#059669', // green-600
                        'primary-dark': '#047857', // green-700
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary" viewBox="0 0 20 20" fill="currentColor"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0115 15v3h1zM4.75 12.094A5.973 5.973 0 004 15v3H3v-3a3.005 3.005 0 01.75-1.906z" /></svg>
                <h1 class="text-xl font-bold text-gray-700">ADMIN <span class="text-primary">DASHBOARD</span></h1>
            </div>
            <p class="text-sm">Session: <span class="font-semibold">Admin</span></p>
        </div>
    </header>

    <div class="container mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Left Column: Management Lists -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- Reservations Management -->
            <div id="reservations" class="bg-white p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">Gestion des Réservations</h2>
                    <button onclick="openModal('addReservationModal')" class="bg-primary text-white px-4 py-2 rounded-lg font-semibold hover:bg-primary-dark transition">Ajouter une Réservation</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b-2 border-gray-200">
                                <th class="py-2">Entreprise</th>
                                <th class="py-2">Package</th>
                                <th class="py-2">Stand</th>
                                <th class="py-2 text-center">Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for res in reservations %}
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-3 font-semibold">{{ res['company_name'] }}</td>
                                <td class="py-3">{{ res['sponsorship_package'] }}</td>
                                <td class="py-3 font-mono">{{ res['stand_id'] or 'N/A' }}</td>
                                <td class="py-3 text-center">
                                    {% if res['contract_status'] == 'Confirmed' %}
                                    <span class="px-3 py-1 text-xs font-bold text-green-800 bg-green-200 rounded-full">Confirmé</span>
                                    {% elif res['contract_status'] == 'Pending Contract' %}
                                    <span class="px-3 py-1 text-xs font-bold text-yellow-800 bg-yellow-200 rounded-full">Contrat Attendu</span>
                                    {% else %}
                                    <span class="px-3 py-1 text-xs font-bold text-blue-800 bg-blue-200 rounded-full">Devis Attendu</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% else %}
                            <tr><td colspan="4" class="text-center py-4 text-gray-500">Aucune réservation pour le moment.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Companies Management -->
            <div id="companies" class="bg-white p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">Gestion des Entreprises</h2>
                    <button onclick="openModal('addCompanyModal')" class="bg-primary text-white px-4 py-2 rounded-lg font-semibold hover:bg-primary-dark transition">Ajouter une Entreprise</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                             <tr class="border-b-2 border-gray-200">
                                <th class="py-2">Nom</th>
                                <th class="py-2">Représentant</th>
                                <th class="py-2">Email</th>
                            </tr>
                        </thead>
                        <tbody>
                             {% for company in companies %}
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-3 font-semibold">{{ company['name'] }}</td>
                                <td class="py-3">{{ company['representative'] }}</td>
                                <td class="py-3 text-sm text-gray-600">{{ company['email'] }}</td>
                            </tr>
                            {% else %}
                            <tr><td colspan="3" class="text-center py-4 text-gray-500">Aucune entreprise enregistrée.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

        <!-- Right Column: Interactive Stand Map -->
        <div class="lg:col-span-1">
            <div id="stands" class="bg-white p-6 rounded-xl shadow-lg sticky top-24">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Plan des Stands</h2>
                <div class="bg-gray-100 p-4 rounded-lg border border-gray-200">
                    <div id="standGrid" class="grid grid-cols-6 gap-2">
                        {% set rows = ['A', 'B', 'C', 'D', 'E', 'F'] %}
                        {% set cols = range(1, 7) %}
                        {% for row in rows %}
                            {% for col in cols %}
                                {% set stand_id = row ~ col %}
                                <div data-id="{{ stand_id }}" 
                                     class="stand h-12 flex items-center justify-center font-mono text-xs font-semibold border rounded-sm transition-all duration-200 
                                     {% if stand_id in reserved_stands %}
                                         bg-red-300 text-red-800 border-red-400 cursor-not-allowed
                                     {% else %}
                                         bg-green-200 text-green-800 border-green-400 cursor-pointer hover:bg-green-400 hover:scale-110 hover:text-white
                                     {% endif %}">
                                    {{ stand_id }}
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                    <div class="flex justify-around space-x-4 mt-4 text-xs">
                        <div class="flex items-center"><span class="w-3 h-3 bg-green-200 border border-green-400 rounded-sm mr-2"></span>Disponible</div>
                        <div class="flex items-center"><span class="w-3 h-3 bg-red-300 border border-red-400 rounded-sm mr-2"></span>Réservé</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Modals -->
    <!-- Add Company Modal -->
    <div id="addCompanyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
            <h3 class="text-2xl font-bold mb-6">Ajouter une Nouvelle Entreprise</h3>
            <form action="{{ url_for('add_company') }}" method="POST" class="space-y-4">
                <input type="text" name="name" placeholder="Nom de l'entreprise" class="w-full p-3 border rounded-lg" required>
                <input type="text" name="representative" placeholder="Nom du représentant" class="w-full p-3 border rounded-lg" required>
                <input type="email" name="email" placeholder="Email" class="w-full p-3 border rounded-lg" required>
                <input type="tel" name="phone" placeholder="Téléphone" class="w-full p-3 border rounded-lg">
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" onclick="closeModal('addCompanyModal')" class="px-6 py-2 bg-gray-200 rounded-lg font-semibold">Annuler</button>
                    <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg font-semibold">Ajouter</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Reservation Modal -->
    <div id="addReservationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
            <h3 class="text-2xl font-bold mb-6">Créer une Réservation</h3>
            <form action="{{ url_for('add_reservation') }}" method="POST" class="space-y-4">
                <div>
                    <label class="font-semibold">Entreprise</label>
                    <select name="company_id" class="w-full p-3 border rounded-lg mt-1" required>
                        <option value="" disabled selected>-- Choisir une entreprise --</option>
                        {% for company in companies %}
                        <option value="{{ company['id'] }}">{{ company['name'] }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="font-semibold">Package de Sponsoring</label>
                    <select name="sponsorship_package" class="w-full p-3 border rounded-lg mt-1" required>
                        <option>Bronze</option>
                        <option>Silver</option>
                        <option>Gold</option>
                        <option>Platinum</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" onclick="closeModal('addReservationModal')" class="px-6 py-2 bg-gray-200 rounded-lg font-semibold">Annuler</button>
                    <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg font-semibold">Créer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manual Reserve Stand Modal -->
    <div id="reserveStandModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
            <h3 class="text-2xl font-bold mb-2">Réserver le Stand <span id="modalStandId" class="text-primary"></span></h3>
            <p class="text-gray-600 mb-6">Assigner ce stand à une réservation existante.</p>
             <div class="space-y-4">
                <div>
                    <label class="font-semibold">Réservation à assigner</label>
                    <select id="modalReservationSelect" class="w-full p-3 border rounded-lg mt-1">
                        <option value="" disabled selected>-- Choisir une réservation --</option>
                        {% for res in unassigned_reservations %}
                        <option value="{{ res['id'] }}">{{ res['company_name'] }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" onclick="closeModal('reserveStandModal')" class="px-6 py-2 bg-gray-200 rounded-lg font-semibold">Annuler</button>
                    <button type="button" id="confirmStandReservationBtn" class="px-6 py-2 bg-primary text-white rounded-lg font-semibold">Confirmer</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='admin.js') }}"></script>
</body>
</html>